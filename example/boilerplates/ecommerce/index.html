<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <!-- Sets initial viewport load and disables zooming  -->
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <title>Mobility</title>
    
    <!-- Makes your prototype chrome-less once bookmarked to your phone's home screen -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <link rel="stylesheet" type="text/css" href="styles/awesome.css" />
    <link rel="stylesheet" type="text/css" href="styles/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="styles/mobility.css" />
    <link rel="stylesheet" type="text/css" href="styles/mobility-blue.css" />
    <link rel="stylesheet" type="text/css" href="styles/custom.css" />
    
	<script type="text/javascript" src="scripts/jquery.js"></script>
	<script type="text/javascript" src="scripts/doon.js"></script>
    <script type="text/javascript" src="scripts/mobility.js"></script>
    <script type="text/javascript" src="scripts/acquire.js"></script>
    <script type="text/javascript" src="scripts/handlebars.js"></script>
</head>
<body>
	<section class="screen current"></section>
    
    <footer class="foot">
        <nav class="foot-nav" data-do="foot-nav">
        <a 
            class="foot-nav-item" 
            data-do="go-previous" 
            data-on="click" 
            href="/">
            <i class="foot-nav-icon fa fa-home"></i>
            <span class="foot-nav-label">Home</span>
        </a>
        <a 
            class="foot-nav-item" 
            data-do="go-previous" 
            data-on="click" 
            href="/">
            <i class="foot-nav-icon fa fa-star"></i>
            <span class="foot-nav-label">Products</span>
        </a>
        <a 
            class="foot-nav-item" 
            data-do="modal-open" 
            data-on="click" 
            href="#settings">
            <i class="foot-nav-icon fa fa-cog"></i>
            <span class="foot-nav-label">Settings</span>
        </a>
        </nav>
    </footer>
    
    <script type="text/javascript">
	//remote transition are pluggable in this manner
	var remoteHistory = ['/'];
	jQuery(window).on('mobility-request', function(e, target, effect) {
		jQuery(window).one('mobility-swap-complete', function() {
			var current = jQuery('section.screen.current').addClass('loading');
			
			//history
			switch(effect) {
				case 'slide-left':
					remoteHistory.push(target);
					break;
				case 'slide-right':
					if(target !== '/back') {
						break;
					}
					
					remoteHistory.pop();
					target = remoteHistory[remoteHistory.length-1];
			}
			
			//router
			switch(true) {
				case target === '/':
					require('/boilerplates/ecommerce/templates/home.html', function(html) {
						jQuery.mobility.swap(html);
						
						require([
						'/boilerplates/ecommerce/server/products.js', 
						'/boilerplates/ecommerce/templates/row.html'], 
						function(response, template) {
							jQuery('section.body').removeClass('loading');
							
							for(var row, i = 0; i < response.results.length; i++) {
								row = jQuery(Handlebars.compile(template)(response.results[i]));
								jQuery('div.list').append(row);
								row.doon();
							}
							
							jQuery('section.body').scrollTop(180);
						});
						
						jQuery('header a.search-trigger').click(function() {
							if(jQuery('h1.title input.search-field').hasClass('hide')) {
								jQuery('header h1.title span').addClass('hide');
								jQuery('h1.title input.search-field')
									.removeClass('hide')
									.animate({ width: '100%' });
								return;
							}
							
							jQuery('h1.title input.search-field')
								.addClass('hide')
								.css({ width: '0%' });
							
							jQuery('header h1 span').removeClass('hide');
						});
					});
					
					break;
				case target.indexOf('/detail') === 0:
					require([
						'/boilerplates/ecommerce/server'+target+'.js', 
						'/boilerplates/ecommerce/templates/detail.html'], 
					function(response, template) {
						jQuery.mobility.swap(jQuery(Handlebars.compile(template)(response.results)));
						jQuery('header a.search-trigger').click(function() {
							if(jQuery('h1.title input.search-field').hasClass('hide')) {
								jQuery('header h1.title span').addClass('hide');
								jQuery('h1.title input.search-field')
									.removeClass('hide')
									.animate({ width: '100%' });
								return;
							}
							
							jQuery('h1.title input.search-field')
								.addClass('hide')
								.css({ width: '0%' });
							
							jQuery('header h1 span').removeClass('hide');
						});
					});
					
					break;
			}
			
		});
		
		jQuery.mobility.swap('', effect);
	});
	
	//default refresh pagination
    var i = 0;
	jQuery(window).on('mobility-refresh', function(e, target, callback) {
		require([
		'/boilerplates/ecommerce/server/products.js', 
		'/boilerplates/ecommerce/templates/row.html'], 
		function(response, template) {
			var row = Handlebars.compile(template)(response.results[(++i) % 4]);
			
			callback(row);
		});
	});
	
	
	//default paginate pagination
	var j = 0;
	jQuery(window).on('mobility-paginate', function(e, target, callback) {
		setTimeout(function() {
			if(j === 3) {
				callback();
				return;
			}
			
			require([
			'/boilerplates/ecommerce/server/products.js', 
			'/boilerplates/ecommerce/templates/row.html'], 
			function(response, template) {
				var row = Handlebars.compile(template)(response.results[(++i) % 4]);
				
				for(var rows = [], i = 0; i < response.results.length; i++) {
					rows.push(Handlebars.compile(template)(response.results[i]));
				}
				
				callback(rows.join(''));
			});
			
			j++;
		}, 1000);	
	});
	
	//initialize
	jQuery.mobility.start();
	
	jQuery(window).trigger('mobility-request', '/');
	
    </script>
</body>
</html>